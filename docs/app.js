!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"initialize",value:function(e){this.database=e}},{key:"documents",value:function(e){var t={};return e.forEach(function(e){t[e.id]=e.data()}),t}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"searchSpotify",value:function(e,t){return new Promise(function(n,r){var i=e?t+" artist:"+e:t;axios.get("https://wt-3cbd5efe1e55015be8738859f4791dfe-0.run.webtask.io/spotify-search",{params:{album:i}}).then(function(e){n(e)}).catch(r)})}},{key:"getCollection",value:function(){return new Promise(function(e,t){axios.get("https://wt-3cbd5efe1e55015be8738859f4791dfe-0.run.webtask.io/discogs-collection",{params:{full:!0}}).then(e).catch(t)})}},{key:"getReleases",value:function(e){return new Promise(function(t,n){axios.get("https://wt-3cbd5efe1e55015be8738859f4791dfe-0.run.webtask.io/discogs-releases",{params:{ids:e}}).then(t).catch(n)})}}]),e}();t.default=i},function(e,t,n){"use strict";var r=a(n(3)),i=a(n(5));function a(e){return e&&e.__esModule?e:{default:e}}console.info("\n%cDiscogs Library v0.1\n%c© Jake Albaugh "+(new Date).getFullYear()+"\nhttps://twitter.com/jake_albaugh\nhttps://github.com/jakealbaugh/discogs-library\n\n","font-family: sans-serif; font-weight: bold;","font-family: sans-serif; font-weight: normal;");var o=new r.default,s=o.database;window.location.search.match(/\?authorize=true/)?o.authorize(function(e){return new i.default({database:s,visitor:e})}):o.authorizeWithoutSignin(function(e){return new i.default({database:s,visitor:e})},function(){return new i.default({database:null,visitor:{guest:!0,email:"NOPE"}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(4),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=firebase.initializeApp(i),this.database=firebase.firestore(this.app),this.authorized=!1}return r(e,[{key:"authorize",value:function(e){var t=this;this._authorized().then(function(n){t.authorized=!0,e(n)}).catch(this._authorize.bind(this))}},{key:"authorizeWithoutSignin",value:function(e,t){var n=this;this._authorized().then(function(t){n.authorized=!0,e(t)}).catch(function(){return t()})}},{key:"signOut",value:function(){return new Promise(function(e,t){firebase.auth().signOut().then(e).catch(t)})}},{key:"_authorized",value:function(){return new Promise(function(e,t){firebase.auth().onAuthStateChanged(function(n){n?e(n):t()})})}},{key:"_authorize",value:function(){if(!this.authorized){firebase.auth().getRedirectResult().then(function(e){console.log("redirectresult",e.user)});var e=new firebase.auth.GoogleAuthProvider;e.addScope("profile"),e.addScope("email"),firebase.auth().signInWithRedirect(e)}}}]),e}();t.default=a},function(e,t,n){"use strict";e.exports={apiKey:"AIzaSyBBtdbeibfjdKWQLPoPSqWJcU2eMikRihA",authDomain:"discogs-library.firebaseapp.com",databaseURL:"https://discogs-library.firebaseio.com",projectId:"discogs-library",storageBucket:"discogs-library.appspot.com",messagingSenderId:"1050557972233"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(6));a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var o="jake.albaugh@gmail.com",s=function(){function e(t){var n=t.database,r=t.visitor;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.visitor=this._formattedVisitor(r),this.masterUser=this.visitor.email===o,this.store=new i.default(n,this),this.initialize()}return r(e,[{key:"initialize",value:function(){var e=this;this.masterUser?this.store.loadAllDataFromLocalStorage()?(console.info("Data Loaded from localStorage"),this.loadMissingReleasesOrProcess()):this.store.getAllDataFromFirebase().then(function(){console.info("Data Loaded from Firestore"),e.loadMissingReleasesOrProcess()}).catch(this.handleError.bind(this)):this.store.loadAllDataFromJSON().then(function(){console.info("Data Loaded from JSON file"),e.store.process()}).catch(this.handleError.bind(this))}},{key:"loadMissingReleasesOrProcess",value:function(){this.store._.missingReleaseIds.length>0?this.store.loadMissingReleases().then(function(){window.location.reload()}).catch(this.handleError.bind(this)):this.store.process()}},{key:"testLoadingMessages",value:function(){var e=this;this.store.renderer.loading.enable(),this.store.renderer.loading.message("Test a message like it is hot. "+(new Date).getTime()),window.setTimeout(function(){e.testLoadingMessages()},1e3)}},{key:"_formattedVisitor",value:function(e){return{id:e.uid,name:e.displayName,email:e.email,photo:e.photoURL}}},{key:"handleError",value:function(e){console.warn(e),this.store.renderer.loading.disable()}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=s(n(7)),a=s(n(14)),o=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var l="discogs-library-0.1",c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.localKey=l,this.app=n,this.firestore=new i.default(t),this.webtask=new o.default,this.renderer=new a.default(this)}return r(e,[{key:"searchSpotify",value:function(e){var t=this;return new Promise(function(n,r){t.searchSpotifyForRelease(e).then(function(r){t.firestore.updateSpotifyId(e.id,r).then(function(){n(r)})})})}},{key:"updateSpotifyId",value:function(e,t){var n=this;return new Promise(function(r,i){n.firestore.updateSpotifyId(e,t).then(function(){n._.spotify[e]={id:t},n.saveState(),r()}).catch(i)})}},{key:"searchSpotifyForRelease",value:function(e){var t=this,n=e.artists,r=e.title,i=e.id,a=(n=Object.values(n).map(function(e){return e.name}))[1]?n[0]+"OR"+n[1]:n[0];return new Promise(function(e,n){t._.spotify[i]?e(t._.spotify[i].id):""!==t._.spotify[i]?t.webtask.searchSpotify(a,r).then(function(i){var o=i.data.albums.items[0];if(o)e(o.id);else{var s=r.replace(/ \([^\)]+\)$/,"");t.webtask.searchSpotify(a,s).then(function(i){var a=i.data.albums.items[0];a?e(a.id):t.webtask.searchSpotify(null,r).then(function(t){var n=t.data.albums.items[0];e(n?n.id:"")}).catch(n)}).catch(n)}}).catch(n):e("")})}},{key:"loadAllDataFromLocalStorage",value:function(){var e=this._getStore();return!!e&&(this.setData(JSON.parse(e)),!0)}},{key:"getAllDataFromFirebase",value:function(){var e=this;return new Promise(function(t,n){e.renderer.loading.enable(),e.renderer.loading.message("Getting Collection from Database"),e.firestore.getAllData().then(function(n){e.setData(n),e.renderer.loading.disable(),t()}).catch(n)})}},{key:"loadAllDataFromJSON",value:function(){var e=this;return new Promise(function(t,n){e.renderer.loading.enable(),e.renderer.loading.message("Loading Data"),axios.get("data/"+l+".json",{}).then(function(n){e.setData(n.data),e.renderer.loading.disable(),t()}).catch(n)})}},{key:"updateCollection",value:function(){var e=this;return this.renderer.loading.enable(),this.renderer.loading.message("Getting Collection from Discogs"),new Promise(function(t,n){e.webtask.getCollection().then(function(r){e.renderer.loading.message("Writing Collection to Database"),e.firestore.writeCollection(r).then(function(n){e.renderer.loading.message("Wrote Collection to Database"),e._clearStore(),t()}).catch(n)}).catch(n)})}},{key:"setData",value:function(e){var t=this,n=e.user,r=e.collection,i=e.releases,a=e.spotify;this._={user:n,releases:i,spotify:a,collectionFolders:r.folders,collectionReleases:r.releases,missingReleaseIds:[]},Object.keys(this._.collectionReleases).forEach(function(e){t._.releases[e]||t._.missingReleaseIds.push(e)}),this._setStore({user:n,collection:r,releases:i,spotify:a})}},{key:"saveState",value:function(){var e=this._,t=e.user,n=e.collectionReleases,r=e.collectionFolders,i=e.releases,a=e.spotify,o={folders:r,releases:n};this._setStore({user:t,collection:o,releases:i,spotify:a})}},{key:"loadMissingReleases",value:function(){var e=this;return this.renderer.loading.enable(),this.renderer.loading.message("Loading "+this._.missingReleaseIds.length+" Releases from Discogs."),new Promise(function(t,n){for(var r=e._.missingReleaseIds,i=[],a=r.length<=60?60:10;r.length>0;)i.push(r.splice(0,a));var o=i.length,s=e._time(15*o);e.renderer.loading.message("This will take around "+s+" in "+o+" pass(es)."),e.loadReleases(i,o,0).then(function(){e.renderer.loading.message("Completed "+o+" pass(es)"),e._clearStore(),t()}).catch(n)})}},{key:"updateRelease",value:function(e){var t=this;return this.renderer.loading.enable(),new Promise(function(n,r){t.loadReleases([[e]],1,0).then(function(r){t._.releases[e]=r.data[e],t._.spotify[e]?(t.saveState(),t.renderer.loading.disable(),n()):t.searchSpotify(t._.releases[e]).then(function(r){t._.spotify[e]={id:r},t.saveState(),t.renderer.loading.disable(),n()})}).catch(r)})}},{key:"loadReleases",value:function(e,t,n){var r=this,i=e[n].length,a=e[n].join(",");return new Promise(function(o,s){r.webtask.getReleases(a).then(function(a){n++;var l=r._time(15*(t-n+1));r.renderer.loading.message("Got "+n+"/"+t+" batches of Releases from Discogs. ~"+l+" remaining."),n<t?(r.firestore.writeReleases(a).then(function(){r.renderer.loading.message("Wrote "+i+" Releases to Database.")}).catch(s),setTimeout(function(){o(r.loadReleases(e,t,n))},15e3)):r.firestore.writeReleases(a).then(function(){r.renderer.loading.message("Wrote "+i+" Releases to Database."),o(a)}).catch(s)}).catch(s)})}},{key:"process",value:function(){this.searchable=Object.values(this._.collectionReleases).map(this._searchableRelease.bind(this)),this._categorizeReleases(this._.collectionReleases),this.fuseSearch=new Fuse(this.searchable,{shouldSort:!0,includeMatches:!0,tokenize:!0,matchAllTokens:!0,findAllMatches:!0,threshold:.3,location:0,distance:100,maxPatternLength:32,minMatchCharLength:3,keys:["artistTitle"]}),this.randomRelease();var e=Object.keys(this._.spotify),t=Object.values(this._.releases).filter(function(t){return!e.includes(t.id)});t.length>0&&(console.info("Missing Spotify Data"),console.info(t.map(function(e){return{title:e.title,id:e.id}})))}},{key:"randomRelease",value:function(){var e=Object.keys(this._.releases),t=e[Math.floor(Math.random()*e.length)];this.renderer.currResultId=t,this.renderer.release.render(t)}},{key:"search",value:function(e){return this.fuseSearch&&e?this.fuseSearch.search(e):null}},{key:"_time",value:function(e){var t=Math.floor(e/60);return e-=60*t,(t=t<10?"0"+t:t)+":"+(e=e<10?"0"+e:e)}},{key:"_getStore",value:function(){return localStorage.getItem(l)}},{key:"_setStore",value:function(e){localStorage.setItem(l,JSON.stringify(e))}},{key:"_clearStore",value:function(){localStorage.removeItem(l)}},{key:"_searchableRelease",value:function(e){var t=this._.releases[e.id],n={};n.id=t.id,n.title=t.title,n.year=t.year,n.artist=Object.values(t.artists).map(function(e){return e.name}).join(", "),n.artistTitle=n.artist+": "+n.title,n.folder=this._.collectionFolders[e.folderId].name;var r={};return t.formats.forEach(function(e){return r[e.name]=1}),n.format=Object.keys(r).join(", "),n}},{key:"_categorizeReleases",value:function(e){var t=this;this.categorized={artist:{},label:{},companies:{}},Object.values(e).forEach(function(e){var n=t._.releases[e.id];Object.values(n.artists).forEach(function(e){var r=e.name;"Various"!==r&&(t.categorized.artist[r]=t.categorized.artist[r]||[],t.categorized.artist[r].push(n.id))}),Object.values(n.labels).forEach(function(e){var r=e.name;t.categorized.label[r]=t.categorized.label[r]||[],t.categorized.label[r].push(n.id)}),Object.values(n.companies).forEach(function(e){var r=e.type+"-"+e.name;t.categorized.companies[r]=t.categorized.companies[r]||[],t.categorized.companies[r].push(n.id)})})}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(8),o=(r=a)&&r.__esModule?r:{default:r};var s="jakealbaugh",l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var n in o.default)o.default[n].initialize(t)}return i(e,[{key:"getAllData",value:function(){return new Promise(function(e,t){var n={collection:{}};o.default.Spotify.get().then(function(r){n.spotify=r,o.default.Users.get(s).then(function(r){r.exists?(n.user=r.data(),o.default.Folders.getCollectionFolders(s).then(function(r){n.collection.folders=r,o.default.Releases.getCollectionReleases(s).then(function(r){n.collection.releases=r,o.default.Releases.getReleases().then(function(t){n.releases=t,e(n)}).catch(t)}).catch(t)}).catch(t)):(n.user={},n.spotify={},n.collection={folders:{},releases:{}},n.releases={},e(n))}).catch(t)}).catch(t)})}},{key:"writeCollection",value:function(e){return new Promise(function(t,n){200!==e.status&&n(e);e.status;var r=e.data,i=r.user,a=r.releases,s=r.folders;o.default.Users.create(i).then(function(){o.default.Folders.batchCreateCollectionFolders(i,s).then(function(){o.default.Releases.batchCreateCollectionReleases(i,a).then(t).catch(n)}).catch(n)}).catch(n)})}},{key:"writeReleases",value:function(e){return new Promise(function(t,n){200!==e.status&&n(e);e.status;var r=e.data;o.default.Releases.batchCreateReleases(r).then(t).catch(n)})}},{key:"writeSpotify",value:function(e){return new Promise(function(t,n){o.default.Spotify.batchUpdateSpotify(e).then(t).catch(n)})}},{key:"updateSpotifyId",value:function(e,t){return new Promise(function(n,r){o.default.Spotify.updateSpotifyId(e,t).then(n).catch(r)})}}]),e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(9)),i=s(n(10)),a=s(n(12)),o=s(n(13));function s(e){return e&&e.__esModule?e:{default:e}}var l={Folders:new r.default,Releases:new i.default,Spotify:new a.default,Users:new o.default};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),o=(r=a)&&r.__esModule?r:{default:r};var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"batchCreateCollectionFolders",value:function(e,t){var n=this;return new Promise(function(r,i){var a=n.database.batch();for(var o in t){var s=n.database.collection("collections").doc(e.username).collection("folders").doc(o);a.set(s,t[o])}a.commit().then(r).catch(i)})}},{key:"getCollectionFolders",value:function(e){var t=this;return new Promise(function(n,r){t.database.collection("collections").doc(e).collection("folders").get().then(function(e){return n(t.documents(e))}).catch(r)})}}]),t}();t.default=s},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),o=(r=a)&&r.__esModule?r:{default:r};var s=function(t){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,o.default),i(n,[{key:"batchCreateCollectionReleases",value:function(e,t){var n=this;return new Promise(function(r,i){n.batchDelete(e).then(function(){var a=n.database.batch();for(var o in t){var s=n.database.collection("collections").doc(e.username).collection("releases").doc(o);a.set(s,t[o])}a.commit().then(r).catch(i)})})}},{key:"batchDelete",value:function(e){var t=this,n=this.database.collection("collections").doc(e.username).collection("releases").orderBy("__name__").limit(20);return new Promise(function(e,r){t._deleteQueryBatch(n,20,e,r)})}},{key:"batchCreateReleases",value:function(e){var t=this;return new Promise(function(n,r){var i=t.database.batch();for(var a in e){var o=t.database.collection("releases").doc(a);i.set(o,e[a])}i.commit().then(n).catch(r)})}},{key:"getCollectionReleases",value:function(e){var t=this;return new Promise(function(n,r){t.database.collection("collections").doc(e).collection("releases").get().then(function(e){return n(t.documents(e))}).catch(r)})}},{key:"getReleases",value:function(){var e=this;return new Promise(function(t,n){e.database.collection("releases").get().then(function(n){return t(e.documents(n))}).catch(n)})}},{key:"_deleteQueryBatch",value:function(t,n,r,i){var a=this;t.get().then(function(e){if(0==e.size)return 0;var t=a.database.batch();return e.docs.forEach(function(e){t.delete(e.ref)}),t.commit().then(function(){return e.size})}).then(function(o){o<n?r():e.nextTick(function(){a._deleteQueryBatch(t,n,r,i)})}).catch(i)}}]),n}();t.default=s}).call(t,n(11))},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l,c=[],u=!1,f=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):f=-1,c.length&&h())}function h(){if(!u){var e=s(d);u=!0;for(var t=c.length;t;){for(l=c,c=[];++f<t;)l&&l[f].run();f=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),o=(r=a)&&r.__esModule?r:{default:r};var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"updateSpotifyId",value:function(e,t){var n=this;return new Promise(function(r,i){n.database.collection("spotify").doc(e).set({id:t}).then(r).catch(i)})}},{key:"batchUpdateSpotify",value:function(e){var t=this.database.batch();for(var n in e){var r=this.database.collection("spotify").doc(n);t.set(r,e[n].id)}t.commit().then(resolve).catch(reject)}},{key:"get",value:function(){var e=this;return new Promise(function(t,n){e.database.collection("spotify").get().then(function(n){return t(e.documents(n))}).catch(n)})}}]),t}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),o=(r=a)&&r.__esModule?r:{default:r};var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"create",value:function(e){var t=this;return new Promise(function(n,r){t.database.collection("users").doc(e.username).set(e).then(n).catch(r)})}},{key:"get",value:function(e){var t=this;return new Promise(function(n,r){t.database.collection("users").doc(e).get().then(n).catch(r)})}}]),t}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=l(n(15)),a=l(n(16)),o=l(n(17)),s=l(n(18));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store=t,this.view=new s.default(this),this.loading=new i.default(this),this.results=new o.default(this),this.release=new a.default(this),this.resultIds=[],this.currResultIdx=-1,this.setSearch(),this.$downloadStore=document.querySelector("#download-store"),this.$downloadStoreClick=document.querySelector("#download-store-click"),this.$downloadStoreClick.setAttribute("download",this.store.localKey+".json"),this.$updateCollection=document.querySelector("#update-collection"),this.$updateRelease=document.querySelector("#update-release"),this.$randomRelease=document.querySelector("#random-release"),this.$randomRelease.addEventListener("click",function(){n.store.randomRelease()}),this.store.app.masterUser?(this.$updateCollection.addEventListener("click",function(){window.confirm("This might take a bit, are you sure?")&&n.store.updateCollection().then(function(){window.location.reload()})}),this.$updateRelease.addEventListener("click",function(){var e=n.currResultId;e?n.store.updateRelease(e).then(function(){n.release.render(e)}):alert("No Release to Update.")}),this.$downloadStore.addEventListener("click",function(){n.downloadStoreAsJSON()})):(this.$downloadStore.remove(),this.$downloadStoreClick.remove(),this.$updateCollection.remove(),this.$updateRelease.remove()),document.body.addEventListener("keydown",function(e){[40,38,27,13].includes(e.keyCode)&&!n.viewOpen&&e.preventDefault(),40===e.keyCode?n.handleArrowDown():38===e.keyCode?n.handleArrowUp():27===e.keyCode?n.handleEscape():13===e.keyCode&&n.handleReturn()})}return r(e,[{key:"downloadStoreAsJSON",value:function(){var e=encodeURIComponent(this.store._getStore());this.$downloadStoreClick.setAttribute("href","data:text/json;charset=utf-8,"+e),this.$downloadStoreClick.click()}},{key:"setSearch",value:function(){var e=this;this.$search=document.querySelector("#search"),this.$search.focus(),this.$search.addEventListener("input",function(){var t=e.store.search(e.$search.value.replace(/ +$/,""));e.resultIds=[],e.currResultIdx=-1,e.results.render(t),e.handleArrowDown()})}},{key:"handleArrowDown",value:function(){!this.viewOpen&&this.currResultIdx<this.resultIds.length-1&&this.handleCurrentItem(1)}},{key:"handleArrowUp",value:function(){!this.viewOpen&&this.currResultIdx>0&&this.handleCurrentItem(-1)}},{key:"handleReturn",value:function(){var e=this.currResultId;e&&(this.viewOpen=!this.viewOpen,this.viewOpen?(this.view.render(this.store._.releases[e]),this.view.show()):this.view.hide())}},{key:"handleEscape",value:function(){this.viewOpen&&this.view.hide(),this.viewOpen=!1}},{key:"handleItemClick",value:function(e){this.currResultIdx=e,this.handleCurrentItem(0)}},{key:"handleCurrentItem",value:function(e){var t=null;this.resultIds.length>0&&(this.currResultIdx+=e,t=this.resultIds[this.currResultIdx],this.currResultId=t,this.release.render(t)),this.results.setCurrent(t)}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.$container=document.querySelector("#loading"),this.$container.classList.add("hide"),this.$ul=this.$container.querySelector("ul")}return r(e,[{key:"enable",value:function(){this.$container.classList.remove("hide")}},{key:"disable",value:function(){this.$container.classList.add("hide"),this.$ul.innerHTML=""}},{key:"message",value:function(e){var t=document.createElement("li"),n=this.$ul.querySelector("li:first-child");t.innerHTML=e,n?this.$ul.insertBefore(t,n):this.$ul.appendChild(t)}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.store=t.store,this.$container=document.querySelector("#details"),this.$ul=this.$container.querySelector("ul"),this.$image=this.$container.querySelector(".image"),this.$title=this.$container.querySelector(".title"),this.$artist=this.$container.querySelector(".artist"),this.$meta=this.$container.querySelector(".meta"),this.$view=this.$container.querySelector(".view"),this.$artistList=document.querySelector(".artist-list"),this.$labelList=document.querySelector(".label-list"),this.$companyList=document.querySelector(".company-list")}return r(e,[{key:"render",value:function(e){this.renderer.currResultId=e,this.renderer.$search.focus(),this.release=this.store._.releases[e],this.renderMain(),this.renderMeta(),this.renderButton(),this.renderLists()}},{key:"renderLists",value:function(){var e=this,t=[this.release.id];this.$artistList.innerHTML="",Object.values(this.release.artists).forEach(function(n){var r=e.store.categorized.artist[n.name];r&&e.renderList(e.$artistList,n.name,r,!1,t)}),this.$labelList.innerHTML="",Object.values(this.release.labels).forEach(function(n){var r=e.store.categorized.label[n.name];r&&e.renderList(e.$labelList,n.name,r,!0,t,"Label")}),this.$companyList.innerHTML="",Object.values(this.release.companies).forEach(function(n){var r=n.type+"-"+n.name,i=e.store.categorized.companies[r];i&&e.renderList(e.$companyList,n.name,i,!0,t,n.type)})}},{key:"renderMain",value:function(){var e=this.release.images?this.release.images[0]:null;this.$image.style.backgroundImage=e?"url('"+e.uri+"')":"none",this.$title.innerHTML='<a href="https://www.discogs.com/release/'+this.release.id+'" target="blank">\n      '+this.release.title.replace(/ ([^ ]+)$/,"&nbsp;$1")+"\n    </a>";var t=this.release.year>1900?",&nbsp;"+this.release.year:"";this.$artist.innerHTML=Object.values(this.release.artists).map(function(e){return'<span><a href="https://www.discogs.com/artist/'+e.id+'" target="blank">'+e.name+"</a></span>"}).join(", ")+t}},{key:"renderMeta",value:function(){this.$meta.innerHTML="";var e=Object.values(this.release.labels).map(function(e){return'<span>\n            <a href="https://www.discogs.com/label/'+e.id+'" target="blank">\n            '+e.name.split(" ").join("&nbsp;")+"</a>&nbsp;"+e.catno.split(" ").join("&nbsp;")+"</span>"}).join(", ");this.$meta.innerHTML+='<p class="label">'+e+"</p>"}},{key:"renderButton",value:function(){var e=this;this.$view.innerHTML="";var t=document.createElement("button");t.setAttribute("type","button"),t.setAttribute("title","shortcut: return"),t.classList.add("is-small"),t.innerHTML="View",t.addEventListener("click",function(){e.renderer.handleReturn()}),this.$view.appendChild(t)}},{key:"renderList",value:function(e,t,n,r){var i=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=void 0,l=!1;n.forEach(function(n){if(!a.includes(n)){if(!l){var c=document.createElement("p");c.innerHTML=o?o+": "+t:t,e.appendChild(c),s=document.createElement("ul"),e.appendChild(s),l=!0}var u=i.store._.releases[n],f=document.createElement("li"),d=document.createElement("a");d.setAttribute("href","#"),f.appendChild(d),d.addEventListener("click",function(e){e.preventDefault(),i.render(u.id)});var h=u.year>1900?u.year:"",p=u.images?u.images[0]:null;if(d.innerHTML+=p?'<div class="image" style="background-image: url(\''+p.uri+"')\"></div>":'<div class="image"></div>',r){var v=Object.values(u.artists).map(function(e){return e.name}).join(", ");t=u.title,v=i.truncatedString(v),t=i.truncatedString(t),d.innerHTML+="<div><span><span>"+t+"</span><span>"+h+"</span></span><span>"+v+"</span></div>"}else{var y=u.title;y=i.truncatedString(y),d.innerHTML+="<div><span><span>"+y+"</span><span>"+h+"</span></span></div>"}s.appendChild(f)}})}},{key:"truncatedString",value:function(e){return e.length<=27?e:e.substring(0,27).replace(/ +$/,"")+"…"}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.store=t.store,this.$container=document.querySelector("#results")}return r(e,[{key:"setCurrent",value:function(e,t){var n=this.$container.querySelector("li.selected");if(n&&n.classList.remove("selected"),e){var r=this.$container.querySelector("li.release-"+e);r.classList.add("selected"),r.scrollIntoView()}}},{key:"render",value:function(e){var t=this;if(this.currResultIdx=-1,this.$container.innerHTML="",e)for(var n=Math.min(30,e.length),r=function(n){var r=e[n],i=document.createElement("li"),a=document.createElement("a");t.renderer.resultIds.push(r.item.id),i.classList.add("release-"+r.item.id),a.innerHTML=t.renderResult(r),a.setAttribute("href","#"),a.setAttribute("tabindex","-1"),a.addEventListener("click",function(e){e.preventDefault(),a.blur(),t.renderer.$search.focus(),t.renderer.handleItemClick(n)}),i.appendChild(a),t.$container.appendChild(i)},i=0;i<n;i++)r(i)}},{key:"renderResult",value:function(e,t){var n=this,r={};e.matches.forEach(function(e){r[e.key]=n.renderMatch(e)});var i=this.store._.releases[e.item.id],a=i.images?i.images[0]:null,o=void 0;return o=a?'<div class="image" style="background-image: url(\''+a.uri+"')\"></div>":'<div class="image"></div>',o+='\n      <div class="title">',r.artistTitle?o+=r.artistTitle:o+=e.item.artist+": "+e.item.title,o+="\n        "+(e.item.year>1900?"("+e.item.year+")":"")+'\n      </div>\n      <div class="format">\n        '+e.item.format+"\n      </div>"}},{key:"renderMatch",value:function(e){var t=e.value,n=e.indices.map(function(e){return e[0]}),r=e.indices.map(function(e){return e[1]}),i=!0,a="";return t.split("").forEach(function(e,t){i?void 0!==n[0]&&n[0]===t?(n[0]===r[0]?(a+="<span>"+e+"</span>",r.shift()):(a+="<span>"+e,i=!1),n.shift()):a+=e:void 0!==r[0]&&r[0]===t?(a+=e+"</span>",r.shift(),i=!0):a+=e}),a}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.store=t.store,this.$container=document.querySelector("#overlay"),this.$h1=this.$container.querySelector("h1"),this.$image=this.$container.querySelector(".image"),this.$title=this.$container.querySelector(".title"),this.$artist=this.$container.querySelector(".artist"),this.$meta=this.$container.querySelector(".meta"),this.$close=this.$container.querySelector("#close"),this.$updateSpotify=this.$container.querySelector(".update-spotify"),this.$close.addEventListener("click",function(){n.renderer.handleEscape()}),this.$companies=this.$container.querySelector(".companies"),this.$tracklist=this.$container.querySelector(".tracklist ul"),this.$spotify=this.$container.querySelector(".tracklist .spotify-frame"),this.store.app.masterUser&&this.initializeSpotifyForm()}return r(e,[{key:"hide",value:function(){this.$container.classList.add("hide"),this.renderer.$search.focus()}},{key:"show",value:function(){this.$container.classList.remove("hide"),this.$tracklist.focus()}},{key:"render",value:function(e){this.releaseId=e.id,this.release=e,this.collectionRelease=this.store._.collectionReleases[e.id],this.renderImage(),this.renderTitle(),this.renderArtist(),this.renderMeta(),this.renderCompanies(),this.renderTracklist(),this.store.app.masterUser&&this.renderSpotifyForm()}},{key:"renderImage",value:function(){var e=this.release.images[0];this.$image.style.backgroundImage=e?"url('"+e.uri+"')":"none"}},{key:"renderTitle",value:function(){var e=this.release,t=e.title,n=e.id;this.$title.innerHTML='<a href="https://www.discogs.com/release/'+n+'" target="blank">\n      '+t.replace(/ ([^ ]+)$/,"&nbsp;$1")+"\n    </a>",this.$h1.innerHTML=t}},{key:"renderArtist",value:function(){var e=this.release,t=e.artists,n=e.year;n=n>1900?",&nbsp;"+n:"",this.$artist.innerHTML=Object.values(t).map(function(e){return'<span><a href="https://www.discogs.com/artist/'+e.id+'" target="blank">'+e.name+"</a></span>"}).join(", ")+n}},{key:"renderMeta",value:function(){var e=this.release,t=e.formats,n=e.labels,r=this.collectionRelease,i=r.added,a=r.folderId;this.$meta.innerHTML="",n=Object.values(n).map(function(e){return'<span>\n            <a href="https://www.discogs.com/label/'+e.id+'" target="blank">\n            '+e.name.split(" ").join("&nbsp;")+"</a>&nbsp;"+e.catno+"</span>"}).join(", "),this.$meta.innerHTML+='<p class="label">'+n+"</p>";var o={};this.$meta.innerHTML+='<p class="format">'+t.map(function(e){return o[e.name]?"":(o[e.name]=1,"<span>"+e.name+" ("+e.quantity+")</span>")}).join("")+"</p>";var s=this.store._.collectionFolders[a].name,l=this.renderDateFromEpoch(i);this.$meta.innerHTML+='<p class="folder"><strong>'+s+"</strong> "+l+"</p>"}},{key:"renderCompanies",value:function(){var e=this.release.companies;this.$companies.innerHTML="",e=Object.values(e).map(function(e){var t=e.name,n=e.id;return"<span>\n            "+e.type+':\n            <a href="https://www.discogs.com/label/'+n+'" target="blank">\n            '+t.split(" ").join("&nbsp;")+"</a></span>"}).join("<br>"),this.$companies.innerHTML+='<p class="label">'+e+"</p>"}},{key:"initializeSpotifyForm",value:function(){var e=this;this.$updateSpotify.classList.remove("hide"),this.$spotifyId=this.$updateSpotify.querySelector("input"),this.$spotifySubmit=this.$updateSpotify.querySelector("button"),this.$spotifySubmit.addEventListener("click",function(){e.renderer.loading.enable(),e.renderer.loading.message("Updating Spotify Id"),e.store.updateSpotifyId(e.releaseId,e.$spotifyId.value).then(function(){e.renderer.loading.disable(),e.renderTracklist()})})}},{key:"renderSpotifyForm",value:function(){var e=this.store._.spotify[this.releaseId];this.$spotifyId.value=void 0!==e?e.id:""}},{key:"renderTracklist",value:function(){var e=this,t=this.store._.releases[this.releaseId],n=t.tracklist;t.artists,t.title,t.id;this.$tracklist.innerHTML="",this.$spotify.innerHTML="";var r=this.store._.spotify&&this.store._.spotify[t.id];r&&""!==r.id&&(this.$spotify.innerHTML='<iframe src="https://open.spotify.com/embed/album/'+r.id+'"\n          width="300" height="380" frameborder="0" allowtransparency="true"></iframe>',this.$spotify.classList.remove("hide")),n.forEach(function(t){var n=document.createElement("li"),r=t.title.replace(/ ([^ ]+)$/,"&nbsp;$1");n.classList.add(t.type),n.innerHTML="<span>"+t.position+"</span><span>"+r+"</span>",e.$tracklist.appendChild(n)})}},{key:"truncatedString",value:function(e){return e.length<=75?e:e.substring(0,75).replace(/ +$/,"")+"…"}},{key:"renderDateFromEpoch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Date(e),r=n.getFullYear(),i=["January","February","March","April","May","June","July","August","September","October","November","December"][n.getMonth()],a=n.getDate();return t?i+" "+a+", "+r:i+" "+r}}]),e}();t.default=i}]);