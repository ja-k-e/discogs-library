!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"initialize",value:function(e){this.database=e}},{key:"documents",value:function(e){var t={};return e.forEach(function(e){t[e.id]=e.data()}),t}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"searchSpotify",value:function(e,t){return new Promise(function(n,r){var a=t+" artist:"+e;axios.get("https://wt-3cbd5efe1e55015be8738859f4791dfe-0.run.webtask.io/spotify-search",{params:{album:a}}).then(function(e){n(e)}).catch(r)})}},{key:"getCollection",value:function(){return new Promise(function(e,t){axios.get("https://wt-3cbd5efe1e55015be8738859f4791dfe-0.run.webtask.io/discogs-collection",{params:{full:!0}}).then(e).catch(t)})}},{key:"getReleases",value:function(e){return new Promise(function(t,n){axios.get("https://wt-3cbd5efe1e55015be8738859f4791dfe-0.run.webtask.io/discogs-releases",{params:{ids:e}}).then(t).catch(n)})}}]),e}();t.default=a},function(e,t,n){"use strict";var r=i(n(3)),a=i(n(5));function i(e){return e&&e.__esModule?e:{default:e}}console.info("\n%cDiscogs Library v0.1\n%cÂ© Jake Albaugh "+(new Date).getFullYear()+"\nhttps://twitter.com/jake_albaugh\nhttps://github.com/jakealbaugh/discogs-library\n\n","font-family: sans-serif; font-weight: bold;","font-family: sans-serif; font-weight: normal;");var s=new r.default,o=s.database;window.location.search.match(/\?authorize=true/)?s.authorize(function(e){return new a.default({database:o,visitor:e})}):s.authorizeWithoutSignin(function(e){return new a.default({database:o,visitor:e})},function(){return new a.default({database:null,visitor:{guest:!0,email:"NOPE"}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=n(4),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=firebase.initializeApp(a),this.database=firebase.firestore(this.app),this.authorized=!1}return r(e,[{key:"authorize",value:function(e){var t=this;this._authorized().then(function(n){t.authorized=!0,e(n)}).catch(this._authorize.bind(this))}},{key:"authorizeWithoutSignin",value:function(e,t){var n=this;this._authorized().then(function(t){n.authorized=!0,e(t)}).catch(function(){return t()})}},{key:"signOut",value:function(){return new Promise(function(e,t){firebase.auth().signOut().then(e).catch(t)})}},{key:"_authorized",value:function(){return new Promise(function(e,t){firebase.auth().onAuthStateChanged(function(n){n?e(n):t()})})}},{key:"_authorize",value:function(){if(!this.authorized){firebase.auth().getRedirectResult().then(function(e){console.log("redirectresult",e.user)});var e=new firebase.auth.GoogleAuthProvider;e.addScope("profile"),e.addScope("email"),firebase.auth().signInWithRedirect(e)}}}]),e}();t.default=i},function(e,t,n){"use strict";e.exports={apiKey:"AIzaSyBBtdbeibfjdKWQLPoPSqWJcU2eMikRihA",authDomain:"discogs-library.firebaseapp.com",databaseURL:"https://discogs-library.firebaseio.com",projectId:"discogs-library",storageBucket:"discogs-library.appspot.com",messagingSenderId:"1050557972233"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=i(n(6));i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}var s="jake.albaugh@gmail.com",o=function(){function e(t){var n=t.database,r=t.visitor;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.visitor=this._formattedVisitor(r),this.masterUser=this.visitor.email===s,this.store=new a.default(n,this),this.initialize()}return r(e,[{key:"initialize",value:function(){var e=this;this.masterUser?this.store.loadAllDataFromLocalStorage()?(console.info("Data Loaded from localStorage"),this.loadMissingReleasesOrProcess()):this.store.getAllDataFromFirebase().then(function(){console.info("Data Loaded from Firestore"),e.loadMissingReleasesOrProcess()}).catch(this.handleError.bind(this)):this.store.loadAllDataFromJSON().then(function(){console.info("Data Loaded from JSON file"),e.store.process()}).catch(this.handleError.bind(this))}},{key:"loadMissingReleasesOrProcess",value:function(){this.store._.missingReleaseIds.length>0?this.store.loadMissingReleases().then(function(){window.location.reload()}).catch(this.handleError.bind(this)):this.store.process()}},{key:"testLoadingMessages",value:function(){var e=this;this.store.renderer.loading.enable(),this.store.renderer.loading.message("Test a message like it is hot. "+(new Date).getTime()),window.setTimeout(function(){e.testLoadingMessages()},1e3)}},{key:"_formattedVisitor",value:function(e){return{id:e.uid,name:e.displayName,email:e.email,photo:e.photoURL}}},{key:"handleError",value:function(e){console.warn(e),this.store.renderer.loading.disable()}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=o(n(7)),i=o(n(13)),s=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var l="discogs-library-0.1",c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.localKey=l,this.app=n,this.firestore=new a.default(t),this.webtask=new s.default,this.renderer=new i.default(this)}return r(e,[{key:"searchSpotifyForRelease",value:function(e,t){var n=this;return new Promise(function(r,a){n.webtask.searchSpotify(e,t).then(r).catch(a)})}},{key:"loadAllDataFromLocalStorage",value:function(){var e=this._getStore();return!!e&&(this.setData(JSON.parse(e)),!0)}},{key:"getAllDataFromFirebase",value:function(){var e=this;return new Promise(function(t,n){e.renderer.loading.enable(),e.renderer.loading.message("Getting Collection from Database"),e.firestore.getAllData().then(function(n){e.setData(n),e.renderer.loading.disable(),t()}).catch(n)})}},{key:"loadAllDataFromJSON",value:function(){var e=this;return new Promise(function(t,n){e.renderer.loading.enable(),e.renderer.loading.message("Loading Data"),axios.get("data/"+l+".json",{}).then(function(n){e.setData(n.data),e.renderer.loading.disable(),t()}).catch(n)})}},{key:"updateCollection",value:function(){var e=this;return this.renderer.loading.enable(),this.renderer.loading.message("Getting Collection from Discogs"),new Promise(function(t,n){e.webtask.getCollection().then(function(r){e.renderer.loading.message("Writing Collection to Database"),e.firestore.writeCollection(r).then(function(n){e.renderer.loading.message("Wrote Collection to Database"),e._clearStore(),t()}).catch(n)}).catch(n)})}},{key:"setData",value:function(e){var t=this,n=e.user,r=e.collection,a=e.releases;this._={user:n,releases:a,collectionFolders:r.folders,collectionReleases:r.releases,missingReleaseIds:[]},Object.keys(this._.collectionReleases).forEach(function(e){t._.releases[e]||t._.missingReleaseIds.push(e)}),this._setStore({user:n,collection:r,releases:a})}},{key:"loadMissingReleases",value:function(){var e=this;return this.renderer.loading.enable(),this.renderer.loading.message("Loading "+this._.missingReleaseIds.length+" Releases from Discogs."),new Promise(function(t,n){for(var r=e._.missingReleaseIds,a=[],i=r.length<=60?60:10;r.length>0;)a.push(r.splice(0,i));var s=a.length,o=e._time(15*s);e.renderer.loading.message("This will take around "+o+" in "+s+" pass(es)."),e.loadReleases(a,s,0).then(function(){e.renderer.loading.message("Completed "+s+" pass(es)"),e._clearStore(),t()}).catch(n)})}},{key:"updateRelease",value:function(e){var t=this;return this.renderer.loading.enable(),new Promise(function(n,r){t.loadReleases([[e]],1,0).then(function(r){t._.releases[e]=r.data[e];var a=t._,i=a.releases,s=a.user,o={releases:t._.collectionReleases,folders:t._.collectionFolders};t._setStore({user:s,collection:o,releases:i}),t.renderer.loading.disable(),n()}).catch(r)})}},{key:"loadReleases",value:function(e,t,n){var r=this,a=e[n].length,i=e[n].join(",");return new Promise(function(s,o){r.webtask.getReleases(i).then(function(i){n++;var l=r._time(15*(t-n+1));r.renderer.loading.message("Got "+n+"/"+t+" batches of Releases from Discogs. ~"+l+" remaining."),n<t?(r.firestore.writeReleases(i).then(function(){r.renderer.loading.message("Wrote "+a+" Releases to Database.")}).catch(o),setTimeout(function(){s(r.loadReleases(e,t,n))},15e3)):r.firestore.writeReleases(i).then(function(){r.renderer.loading.message("Wrote "+a+" Releases to Database."),s(i)}).catch(o)}).catch(o)})}},{key:"process",value:function(){this.searchable=Object.values(this._.collectionReleases).map(this._searchableRelease.bind(this)),this._categorizeReleases(this._.collectionReleases),this.fuseSearch=new Fuse(this.searchable,{shouldSort:!0,includeMatches:!0,tokenize:!0,matchAllTokens:!0,findAllMatches:!0,threshold:.3,location:0,distance:100,maxPatternLength:32,minMatchCharLength:3,keys:["artistTitle"]}),this.randomRelease()}},{key:"randomRelease",value:function(){var e=Object.keys(this._.releases),t=e[Math.floor(Math.random()*e.length)];this.renderer.release.render(t)}},{key:"search",value:function(e){return this.fuseSearch&&e?this.fuseSearch.search(e):null}},{key:"_time",value:function(e){var t=Math.floor(e/60);return e-=60*t,(t=t<10?"0"+t:t)+":"+(e=e<10?"0"+e:e)}},{key:"_getStore",value:function(){return localStorage.getItem(l)}},{key:"_setStore",value:function(e){localStorage.setItem(l,JSON.stringify(e))}},{key:"_clearStore",value:function(){localStorage.removeItem(l)}},{key:"_searchableRelease",value:function(e){var t=this._.releases[e.id],n={};n.id=t.id,n.title=t.title,n.year=t.year,n.artist=Object.values(t.artists).map(function(e){return e.name}).join(", "),n.artistTitle=n.artist+": "+n.title,n.folder=this._.collectionFolders[e.folderId].name;var r={};return t.formats.forEach(function(e){return r[e.name]=1}),n.format=Object.keys(r).join(", "),n}},{key:"_categorizeReleases",value:function(e){var t=this;this.categorized={artist:{},label:{},companies:{}},Object.values(e).forEach(function(e){var n=t._.releases[e.id];Object.values(n.artists).forEach(function(e){var r=e.name;"Various"!==r&&(t.categorized.artist[r]=t.categorized.artist[r]||[],t.categorized.artist[r].push(n.id))}),Object.values(n.labels).forEach(function(e){var r=e.name;t.categorized.label[r]=t.categorized.label[r]||[],t.categorized.label[r].push(n.id)}),Object.values(n.companies).forEach(function(e){var r=e.type+"-"+e.name;t.categorized.companies[r]=t.categorized.companies[r]||[],t.categorized.companies[r].push(n.id)})})}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(8),s=(r=i)&&r.__esModule?r:{default:r};var o="jakealbaugh",l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var n in s.default)s.default[n].initialize(t)}return a(e,[{key:"getAllData",value:function(){return new Promise(function(e,t){var n={collection:{}};s.default.Users.get(o).then(function(r){r.exists?(n.user=r.data(),s.default.Folders.getCollectionFolders(o).then(function(r){n.collection.folders=r,s.default.Releases.getCollectionReleases(o).then(function(r){n.collection.releases=r,s.default.Releases.getReleases().then(function(t){n.releases=t,e(n)}).catch(t)}).catch(t)}).catch(t)):(n.user={},n.collection={folders:{},releases:{}},n.releases={},e(n))}).catch(t)})}},{key:"writeCollection",value:function(e){return new Promise(function(t,n){200!==e.status&&n(e);e.status;var r=e.data,a=r.user,i=r.releases,o=r.folders;s.default.Users.create(a).then(function(){s.default.Folders.batchCreateCollectionFolders(a,o).then(function(){s.default.Releases.batchCreateCollectionReleases(a,i).then(t).catch(n)}).catch(n)}).catch(n)})}},{key:"writeReleases",value:function(e){return new Promise(function(t,n){200!==e.status&&n(e);e.status;var r=e.data;s.default.Releases.batchCreateReleases(r).then(t).catch(n)})}}]),e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(9)),a=s(n(10)),i=s(n(12));function s(e){return e&&e.__esModule?e:{default:e}}var o={Folders:new r.default,Releases:new a.default,Users:new i.default};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),s=(r=i)&&r.__esModule?r:{default:r};var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),a(t,[{key:"batchCreateCollectionFolders",value:function(e,t){var n=this;return new Promise(function(r,a){var i=n.database.batch();for(var s in t){var o=n.database.collection("collections").doc(e.username).collection("folders").doc(s);i.set(o,t[s])}i.commit().then(r).catch(a)})}},{key:"getCollectionFolders",value:function(e){var t=this;return new Promise(function(n,r){t.database.collection("collections").doc(e).collection("folders").get().then(function(e){return n(t.documents(e))}).catch(r)})}}]),t}();t.default=o},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),s=(r=i)&&r.__esModule?r:{default:r};var o=function(t){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,s.default),a(n,[{key:"batchCreateCollectionReleases",value:function(e,t){var n=this;return new Promise(function(r,a){n.batchDelete(e).then(function(){var i=n.database.batch();for(var s in t){var o=n.database.collection("collections").doc(e.username).collection("releases").doc(s);i.set(o,t[s])}i.commit().then(r).catch(a)})})}},{key:"batchDelete",value:function(e){var t=this,n=this.database.collection("collections").doc(e.username).collection("releases").orderBy("__name__").limit(20);return new Promise(function(e,r){t._deleteQueryBatch(n,20,e,r)})}},{key:"batchCreateReleases",value:function(e){var t=this;return new Promise(function(n,r){var a=t.database.batch();for(var i in e){var s=t.database.collection("releases").doc(i);a.set(s,e[i])}a.commit().then(n).catch(r)})}},{key:"getCollectionReleases",value:function(e){var t=this;return new Promise(function(n,r){t.database.collection("collections").doc(e).collection("releases").get().then(function(e){return n(t.documents(e))}).catch(r)})}},{key:"getReleases",value:function(){var e=this;return new Promise(function(t,n){e.database.collection("releases").get().then(function(n){return t(e.documents(n))}).catch(n)})}},{key:"_deleteQueryBatch",value:function(t,n,r,a){var i=this;t.get().then(function(e){if(0==e.size)return 0;var t=i.database.batch();return e.docs.forEach(function(e){t.delete(e.ref)}),t.commit().then(function(){return e.size})}).then(function(s){s<n?r():e.nextTick(function(){i._deleteQueryBatch(t,n,r,a)})}).catch(a)}}]),n}();t.default=o}).call(t,n(11))},function(e,t){var n,r,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l,c=[],u=!1,d=-1;function f(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&h())}function h(){if(!u){var e=o(f);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||o(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),s=(r=i)&&r.__esModule?r:{default:r};var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),a(t,[{key:"create",value:function(e){var t=this;return new Promise(function(n,r){t.database.collection("users").doc(e.username).set(e).then(n).catch(r)})}},{key:"get",value:function(e){var t=this;return new Promise(function(n,r){t.database.collection("users").doc(e).get().then(n).catch(r)})}}]),t}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=l(n(14)),i=l(n(15)),s=l(n(16)),o=l(n(17));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store=t,this.view=new o.default(this),this.loading=new a.default(this),this.results=new s.default(this),this.release=new i.default(this),this.resultIds=[],this.currResultIdx=-1,this.setSearch(),this.$downloadStore=document.querySelector("#download-store"),this.$downloadStoreClick=document.querySelector("#download-store-click"),this.$downloadStoreClick.setAttribute("download",this.store.localKey+".json"),this.$updateCollection=document.querySelector("#update-collection"),this.$updateRelease=document.querySelector("#update-release"),this.$randomRelease=document.querySelector("#random-release"),this.$randomRelease.addEventListener("click",function(){n.store.randomRelease()}),this.store.app.masterUser?(this.$updateCollection.addEventListener("click",function(){window.confirm("This might take a bit, are you sure?")&&n.store.updateCollection().then(function(){window.location.reload()})}),this.$updateRelease.addEventListener("click",function(){var e=n.resultIds[n.currResultIdx];e?n.store.updateRelease(e).then(function(){n.release.render(e)}):alert("No Release to Update.")}),this.$downloadStore.addEventListener("click",function(){n.downloadStoreAsJSON()})):(this.$downloadStore.remove(),this.$downloadStoreClick.remove(),this.$updateCollection.remove(),this.$updateRelease.remove()),document.body.addEventListener("keydown",function(e){[40,38,27,13].includes(e.keyCode)&&!n.viewOpen&&e.preventDefault(),40===e.keyCode?n.handleArrowDown():38===e.keyCode?n.handleArrowUp():27===e.keyCode?n.handleEscape():13===e.keyCode&&n.handleReturn()})}return r(e,[{key:"downloadStoreAsJSON",value:function(){var e=encodeURIComponent(this.store._getStore());this.$downloadStoreClick.setAttribute("href","data:text/json;charset=utf-8,"+e),this.$downloadStoreClick.click()}},{key:"setSearch",value:function(){var e=this;this.$search=document.querySelector("#search"),this.$search.focus(),this.$search.addEventListener("input",function(){var t=e.store.search(e.$search.value.replace(/ +$/,""));e.resultIds=[],e.currResultIdx=-1,e.results.render(t),e.handleArrowDown()})}},{key:"handleArrowDown",value:function(){!this.viewOpen&&this.currResultIdx<this.resultIds.length-1&&this.handleCurrentItem(1)}},{key:"handleArrowUp",value:function(){!this.viewOpen&&this.currResultIdx>0&&this.handleCurrentItem(-1)}},{key:"handleReturn",value:function(){var e=this.currResultId;e&&(this.viewOpen=!this.viewOpen,this.viewOpen?(this.view.render(this.store._.releases[e]),this.view.show()):this.view.hide())}},{key:"handleEscape",value:function(){this.viewOpen&&this.view.hide(),this.viewOpen=!1}},{key:"handleItemClick",value:function(e){this.currResultIdx=e,this.handleCurrentItem(0)}},{key:"handleCurrentItem",value:function(e){var t=null;this.resultIds.length>0&&(this.currResultIdx+=e,t=this.resultIds[this.currResultIdx],this.currResultId=t,this.release.render(t)),this.results.setCurrent(t)}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.$container=document.querySelector("#loading"),this.$container.classList.add("hide"),this.$ul=this.$container.querySelector("ul")}return r(e,[{key:"enable",value:function(){this.$container.classList.remove("hide")}},{key:"disable",value:function(){this.$container.classList.add("hide"),this.$ul.innerHTML=""}},{key:"message",value:function(e){var t=document.createElement("li"),n=this.$ul.querySelector("li:first-child");t.innerHTML=e,n?this.$ul.insertBefore(t,n):this.$ul.appendChild(t)}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.store=t.store,this.$container=document.querySelector("#details"),this.$container.classList.add("hide"),this.$ul=this.$container.querySelector("ul"),this.$image=this.$container.querySelector(".image"),this.$title=this.$container.querySelector(".title"),this.$artist=this.$container.querySelector(".artist"),this.$meta=this.$container.querySelector(".meta"),this.$view=this.$container.querySelector(".view"),this.$artistList=document.querySelector(".artist-list"),this.$labelList=document.querySelector(".label-list"),this.$companyList=document.querySelector(".company-list")}return r(e,[{key:"render",value:function(e){this.renderer.currResultId=e,this.renderer.$search.focus(),this.release=this.store._.releases[e],this.renderMain(),this.renderMeta(),this.renderButton(),this.renderLists()}},{key:"renderLists",value:function(){var e=this,t=[this.release.id];this.$artistList.innerHTML="",Object.values(this.release.artists).forEach(function(n){var r=e.store.categorized.artist[n.name];r&&e.renderList(e.$artistList,n.name,r,!1,t)}),this.$labelList.innerHTML="",Object.values(this.release.labels).forEach(function(n){var r=e.store.categorized.label[n.name];r&&e.renderList(e.$labelList,n.name,r,!0,t,"Label")}),this.$companyList.innerHTML="",Object.values(this.release.companies).forEach(function(n){var r=n.type+"-"+n.name,a=e.store.categorized.companies[r];a&&e.renderList(e.$companyList,n.name,a,!0,t,n.type)})}},{key:"renderMain",value:function(){var e=this.release.images?this.release.images[0]:null;this.$image.style.backgroundImage=e?"url('"+e.uri+"')":"none",this.$title.innerHTML='<a href="https://www.discogs.com/release/'+this.release.id+'" target="blank">\n      '+this.release.title.replace(/ ([^ ]+)$/,"&nbsp;$1")+"\n    </a>";var t=this.release.year>1900?",&nbsp;"+this.release.year:"";this.$artist.innerHTML=Object.values(this.release.artists).map(function(e){return'<span><a href="https://www.discogs.com/artist/'+e.id+'" target="blank">'+e.name+"</a></span>"}).join(", ")+t}},{key:"renderMeta",value:function(){this.$meta.innerHTML="";var e=Object.values(this.release.labels).map(function(e){return'<span>\n            <a href="https://www.discogs.com/label/'+e.id+'" target="blank">\n            '+e.name.split(" ").join("&nbsp;")+"</a>&nbsp;"+e.catno.split(" ").join("&nbsp;")+"</span>"}).join(", ");this.$meta.innerHTML+='<p class="label">'+e+"</p>"}},{key:"renderButton",value:function(){var e=this;this.$view.innerHTML="";var t=document.createElement("button");t.setAttribute("type","button"),t.setAttribute("title","shortcut: return"),t.classList.add("is-small"),t.innerHTML="View",t.addEventListener("click",function(){e.renderer.handleReturn()}),this.$view.appendChild(t)}},{key:"renderList",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=void 0,l=!1;n.forEach(function(n){if(!i.includes(n)){if(!l){var c=document.createElement("p");c.innerHTML=s?s+": "+t:t,e.appendChild(c),o=document.createElement("ul"),e.appendChild(o),l=!0}var u=a.store._.releases[n],d=document.createElement("li"),f=document.createElement("a");f.setAttribute("href","#"),d.appendChild(f),f.addEventListener("click",function(e){e.preventDefault(),a.render(u.id)});var h=u.year>1900?u.year:"",p=u.images?u.images[0]:null;if(f.innerHTML+=p?'<div class="image" style="background-image: url(\''+p.uri+"')\"></div>":'<div class="image"></div>',r){var v=Object.values(u.artists).map(function(e){return e.name}).join(", ");t=u.title,v=a.truncatedString(v),t=a.truncatedString(t),f.innerHTML+="<div><span><span>"+t+"</span><span>"+h+"</span></span><span>"+v+"</span></div>"}else{var m=u.title;m=a.truncatedString(m),f.innerHTML+="<div><span><span>"+m+"</span><span>"+h+"</span></span></div>"}o.appendChild(d)}})}},{key:"truncatedString",value:function(e){return e.length<=27?e:e.substring(0,27).replace(/ +$/,"")+"â¦"}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.store=t.store,this.$container=document.querySelector("#results")}return r(e,[{key:"setCurrent",value:function(e,t){var n=this.$container.querySelector("li.selected");if(n&&n.classList.remove("selected"),e){var r=this.$container.querySelector("li.release-"+e);r.classList.add("selected"),r.scrollIntoView()}}},{key:"render",value:function(e){var t=this;if(this.currResultIdx=-1,this.$container.innerHTML="",e)for(var n=Math.min(30,e.length),r=function(n){var r=e[n],a=document.createElement("li"),i=document.createElement("a");t.renderer.resultIds.push(r.item.id),a.classList.add("release-"+r.item.id),i.innerHTML=t.renderResult(r),i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),i.addEventListener("click",function(e){e.preventDefault(),i.blur(),t.renderer.$search.focus(),t.renderer.handleItemClick(n)}),a.appendChild(i),t.$container.appendChild(a)},a=0;a<n;a++)r(a)}},{key:"renderResult",value:function(e,t){var n=this,r={};e.matches.forEach(function(e){r[e.key]=n.renderMatch(e)});var a=this.store._.releases[e.item.id],i=a.images?a.images[0]:null,s=void 0;return s=i?'<div class="image" style="background-image: url(\''+i.uri+"')\"></div>":'<div class="image"></div>',s+='\n      <div class="title">',r.artistTitle?s+=r.artistTitle:s+=e.item.artist+": "+e.item.title,s+="\n        "+(e.item.year>1900?"("+e.item.year+")":"")+'\n      </div>\n      <div class="format">\n        '+e.item.format+"\n      </div>"}},{key:"renderMatch",value:function(e){var t=e.value,n=e.indices.map(function(e){return e[0]}),r=e.indices.map(function(e){return e[1]}),a=!0,i="";return t.split("").forEach(function(e,t){a?void 0!==n[0]&&n[0]===t?(n[0]===r[0]?(i+="<span>"+e+"</span>",r.shift()):(i+="<span>"+e,a=!1),n.shift()):i+=e:void 0!==r[0]&&r[0]===t?(i+=e+"</span>",r.shift(),a=!0):i+=e}),i}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.store=t.store,this.$container=document.querySelector("#overlay"),this.$h1=this.$container.querySelector("h1"),this.$image=this.$container.querySelector(".image"),this.$title=this.$container.querySelector(".title"),this.$artist=this.$container.querySelector(".artist"),this.$meta=this.$container.querySelector(".meta"),this.$spotify=this.$container.querySelector(".spotify"),this.$close=this.$container.querySelector("#close"),this.$close.addEventListener("click",function(){n.renderer.handleEscape()}),this.$companies=this.$container.querySelector(".companies"),this.$tracklist=this.$container.querySelector(".tracklist")}return r(e,[{key:"hide",value:function(){this.$container.classList.add("hide"),this.renderer.$search.focus()}},{key:"show",value:function(){this.$container.classList.remove("hide"),this.$tracklist.focus()}},{key:"render",value:function(e){var t=this.store._.collectionReleases[e.id];this.renderImage(e),this.renderTitle(e),this.renderArtist(e),this.renderMeta(e,t),this.renderCompanies(e),this.renderTracklist(e)}},{key:"renderImage",value:function(e){var t=e.images[0];this.$image.style.backgroundImage=t?"url('"+t.uri+"')":"none"}},{key:"renderTitle",value:function(e){var t=e.title,n=e.id;this.$title.innerHTML='<a href="https://www.discogs.com/release/'+n+'" target="blank">\n      '+t.replace(/ ([^ ]+)$/,"&nbsp;$1")+"\n    </a>",this.$h1.innerHTML=t}},{key:"renderArtist",value:function(e){var t=e.artists,n=e.year;n=n>1900?",&nbsp;"+n:"",this.$artist.innerHTML=Object.values(t).map(function(e){return'<span><a href="https://www.discogs.com/artist/'+e.id+'" target="blank">'+e.name+"</a></span>"}).join(", ")+n}},{key:"renderMeta",value:function(e,t){var n=e.formats,r=e.labels,a=t.added,i=t.folderId;this.$meta.innerHTML="",r=Object.values(r).map(function(e){return'<span>\n            <a href="https://www.discogs.com/label/'+e.id+'" target="blank">\n            '+e.name.split(" ").join("&nbsp;")+"</a>&nbsp;"+e.catno+"</span>"}).join(", "),this.$meta.innerHTML+='<p class="label">'+r+"</p>";var s={};this.$meta.innerHTML+='<p class="format">'+n.map(function(e){return s[e.name]?"":(s[e.name]=1,"<span>"+e.name+" ("+e.quantity+")</span>")}).join("")+"</p>";var o=this.store._.collectionFolders[i].name,l=this.renderDateFromEpoch(a);this.$meta.innerHTML+='<p class="folder"><strong>'+o+"</strong> "+l+"</p>"}},{key:"renderCompanies",value:function(e){var t=e.companies;this.$companies.innerHTML="",t=Object.values(t).map(function(e){var t=e.name,n=e.id;return"<span>\n            "+e.type+':\n            <a href="https://www.discogs.com/label/'+n+'" target="blank">\n            '+t.split(" ").join("&nbsp;")+"</a></span>"}).join("<br>"),this.$companies.innerHTML+='<p class="label">'+t+"</p>"}},{key:"renderTracklist",value:function(e){var t=this,n=e.tracklist,r=e.artists,a=e.title;this.$tracklist.innerHTML="";var i=Object.values(r)[0].name;this.renderer.store.searchSpotifyForRelease(i,a).then(function(e){var r=e.data.albums.items[0];r&&(t.$tracklist.innerHTML='\n          <iframe src="https://open.spotify.com/embed/album/'+r.id+'"\n            width="300" height="380" frameborder="0" allowtransparency="true"></iframe>');var a=document.createElement("ul");t.$tracklist.appendChild(a),n.forEach(function(e){var t=document.createElement("li"),n=e.title.replace(/ ([^ ]+)$/,"&nbsp;$1");t.classList.add(e.type),t.innerHTML="<span>"+e.position+"</span><span>"+n+"</span>",a.appendChild(t)})})}},{key:"truncatedString",value:function(e){return e.length<=75?e:e.substring(0,75).replace(/ +$/,"")+"â¦"}},{key:"renderDateFromEpoch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Date(e),r=n.getFullYear(),a=["January","February","March","April","May","June","July","August","September","October","November","December"][n.getMonth()],i=n.getDate();return t?a+" "+i+", "+r:a+" "+r}}]),e}();t.default=a}]);