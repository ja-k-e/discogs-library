!function(n){var r={};function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=n,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"initialize",value:function(e){this.database=e}},{key:"documents",value:function(e){var t={};return e.forEach(function(e){t[e.id]=e.data()}),t}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderer=e,this.store=e.store,this.$container=document.querySelector("#details"),this.$ul=this.$container.querySelector("ul"),this.$image=this.$container.querySelector(".image"),this.$title=this.$container.querySelector(".title"),this.$artist=this.$container.querySelector(".artist"),this.$meta=this.$container.querySelector(".meta"),this.$view=this.$container.querySelector(".view"),this.$artistList=document.querySelector(".artist-list"),this.$labelList=document.querySelector(".label-list"),this.$companyList=document.querySelector(".company-list")}return r(t,[{key:"renderList",value:function(l,u,e,f){var h=this,d=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[],p=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,m=void 0,y=!1;e.forEach(function(e){if(!d.includes(e)){if(!y){var t=document.createElement("p");t.innerHTML=p?p+": "+u:u,l.appendChild(t),m=document.createElement("ul"),l.appendChild(m),y=!0}var n=h.store._.releases[e],r=document.createElement("li"),i=document.createElement("a");i.setAttribute("href","#"),r.appendChild(i),i.addEventListener("click",function(e){e.preventDefault(),h.renderer.results.itemType="release",h.renderer.release.render(n.id)});var a=1900<n.year?n.year:"",s=n.images?n.images[0]:null;if(i.innerHTML+=s?'<div class="image" style="background-image: url(\''+s.uri+"')\"></div>":'<div class="image"></div>',f){var o=Object.values(n.artists).map(function(e){return e.name}).join(", ");u=n.title,o=h.truncatedString(o),u=h.truncatedString(u),i.innerHTML+="<div><span><span>"+u+"</span><span>"+a+"</span></span><span>"+o+"</span></div>"}else{var c=n.title;c=h.truncatedString(c),i.innerHTML+="<div><span><span>"+c+"</span><span>"+a+"</span></span></div>"}m.appendChild(r)}})}},{key:"truncatedString",value:function(e){return e.length<=27?e:e.substring(0,27).replace(/ +$/,"")+"…"}}]),t}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"searchSpotify",value:function(r,i){return new Promise(function(t,e){var n=r?i+" artist:"+r:i;axios.get("https://wt-3cbd5efe1e55015be8738859f4791dfe-0.sandbox.auth0-extend.com/spotify-search",{params:{album:n}}).then(function(e){t(e)}).catch(e)})}},{key:"getCollection",value:function(){return new Promise(function(e,t){axios.get("https://wt-3cbd5efe1e55015be8738859f4791dfe-0.sandbox.auth0-extend.com/discogs-collection",{params:{full:!0}}).then(e).catch(t)})}},{key:"getRecent",value:function(){return new Promise(function(e,t){axios.get("https://wt-3cbd5efe1e55015be8738859f4791dfe-0.sandbox.auth0-extend.com/discogs-collection-recent",{params:{}}).then(e).catch(t)})}},{key:"getReleases",value:function(n){return new Promise(function(e,t){axios.get("https://wt-3cbd5efe1e55015be8738859f4791dfe-0.sandbox.auth0-extend.com/discogs-releases",{params:{ids:n}}).then(e).catch(t)})}}]),e}();t.default=i},function(e,t,n){"use strict";var r=a(n(4)),i=a(n(6));function a(e){return e&&e.__esModule?e:{default:e}}console.info("\n%cDiscogs Library v0.1\n%c© Jake Albaugh "+(new Date).getFullYear()+"\nhttps://twitter.com/jake_albaugh\nhttps://github.com/jakealbaugh/discogs-library\n\n","font-family: sans-serif; font-weight: bold;","font-family: sans-serif; font-weight: normal;");var s=new r.default,o=s.database;window.location.search.match(/\?auth=true/)?s.authorize(function(e){return new i.default({database:o,visitor:e})}):s.authorizeWithoutSignin(function(e){return new i.default({database:o,visitor:e})},function(){return new i.default({database:null,visitor:{guest:!0,email:"NOPE"}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var i=n(5),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=firebase.initializeApp(i),this.database=firebase.firestore(this.app),this.authorized=!1}return r(e,[{key:"authorize",value:function(t){var n=this;this._authorized().then(function(e){n.authorized=!0,t(e)}).catch(this._authorize.bind(this))}},{key:"authorizeWithoutSignin",value:function(t,e){var n=this;this._authorized().then(function(e){n.authorized=!0,t(e)}).catch(function(){return e()})}},{key:"signOut",value:function(){return new Promise(function(e,t){firebase.auth().signOut().then(e).catch(t)})}},{key:"_authorized",value:function(){return new Promise(function(t,n){firebase.auth().onAuthStateChanged(function(e){e?t(e):n()})})}},{key:"_authorize",value:function(){if(!this.authorized){firebase.auth().getRedirectResult().then(function(e){console.log("redirectresult",e.user)});var e=new firebase.auth.GoogleAuthProvider;e.addScope("profile"),e.addScope("email"),firebase.auth().signInWithRedirect(e)}}}]),e}();t.default=a},function(e,t,n){"use strict";e.exports={apiKey:"AIzaSyBBtdbeibfjdKWQLPoPSqWJcU2eMikRihA",authDomain:"discogs-library.firebaseapp.com",databaseURL:"https://discogs-library.firebaseio.com",projectId:"discogs-library",storageBucket:"discogs-library.appspot.com",messagingSenderId:"1050557972233"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=r(n(7));r(n(2));function r(e){return e&&e.__esModule?e:{default:e}}var s=function(){function r(e){var t=e.database,n=e.visitor;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.visitor=this._formattedVisitor(n),this.masterUser="jake.albaugh@gmail.com"===this.visitor.email,this.store=new a.default(t,this),this.initialize()}return i(r,[{key:"initialize",value:function(){var e=this;this.masterUser?this.store.loadAllDataFromLocalStorage()?(console.info("Data Loaded from localStorage"),this.loadMissingReleasesOrProcess()):this.store.getAllDataFromFirebase().then(function(){console.info("Data Loaded from Firestore"),e.loadMissingReleasesOrProcess()}).catch(this.handleError.bind(this)):this.store.loadAllDataFromJSON().then(function(){console.info("Data Loaded from JSON file"),e.store.process()}).catch(this.handleError.bind(this))}},{key:"loadMissingReleasesOrProcess",value:function(){0<this.store._.missingReleaseIds.length?this.store.loadMissingReleases().then(function(){window.location.reload()}).catch(this.handleError.bind(this)):this.store.process()}},{key:"testLoadingMessages",value:function(){var e=this;this.store.renderer.loading.enable(),this.store.renderer.loading.message("Test a message like it is hot. "+(new Date).getTime()),window.setTimeout(function(){e.testLoadingMessages()},1e3)}},{key:"_formattedVisitor",value:function(e){return{id:e.uid,name:e.displayName,email:e.email,photo:e.photoURL}}},{key:"handleError",value:function(e){console.warn(e),this.store.renderer.loading.disable()}}]),r}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=o(n(8)),a=o(n(15)),s=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}var c="discogs-library-0.1",l=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.localKey=c,this.app=t,this.firestore=new i.default(e),this.webtask=new s.default,this.renderer=new a.default(this)}return r(n,[{key:"searchSpotify",value:function(n){var r=this;return new Promise(function(t,e){r.searchSpotifyForRelease(n).then(function(e){r.firestore.updateSpotifyId(n.id,e).then(function(){t(e)})})})}},{key:"updateSpotifyId",value:function(n,r){var i=this;return new Promise(function(e,t){i.firestore.updateSpotifyId(n,r).then(function(){i._.spotify[n]={id:r},i.saveState(),e()}).catch(t)})}},{key:"searchSpotifyForRelease",value:function(e){var a=this,t=e.artists,s=e.title,n=e.id,o=(t=Object.values(t).map(function(e){return e.name}))[1]?t[0]+"OR"+t[1]:t[0];return new Promise(function(r,i){a._.spotify[n]?r(a._.spotify[n].id):""!==a._.spotify[n]?a.webtask.searchSpotify(o,s).then(function(e){var t=e.data.albums.items[0];if(t)r(t.id);else{var n=s.replace(/ \([^\)]+\)$/,"");a.webtask.searchSpotify(o,n).then(function(e){var t=e.data.albums.items[0];t?r(t.id):a.webtask.searchSpotify(null,s).then(function(e){var t=e.data.albums.items[0];r(t?t.id:"")}).catch(i)}).catch(i)}}).catch(i):r("")})}},{key:"loadAllDataFromLocalStorage",value:function(){var e=this._getStore();return!!e&&(this.setData(JSON.parse(e)),!0)}},{key:"getAllDataFromFirebase",value:function(){var n=this;return new Promise(function(t,e){n.renderer.loading.enable(),n.renderer.loading.message("Getting Collection from Database"),n.firestore.getAllData().then(function(e){n.setData(e),n.renderer.loading.disable(),t()}).catch(e)})}},{key:"loadAllDataFromJSON",value:function(){var n=this;return new Promise(function(t,e){n.renderer.loading.enable(),n.renderer.loading.message("Loading Data"),axios.get("data/"+c+".json",{}).then(function(e){n.setData(e.data),n.renderer.loading.disable(),t()}).catch(e)})}},{key:"writeCollection",value:function(){var r=this;return this.renderer.loading.enable(),this.renderer.loading.message("Getting Collection from Discogs"),new Promise(function(t,n){r.webtask.getCollection().then(function(e){r.renderer.loading.message("Writing Collection to Database"),r.firestore.writeCollection(e).then(function(e){r.renderer.loading.message("Wrote Collection to Database"),r._clearStore(),t()}).catch(n)}).catch(n)})}},{key:"updateCollection",value:function(){var r=this;return this.renderer.loading.enable(),this.renderer.loading.message("Getting Recent Releases from Discogs"),new Promise(function(t,n){r.webtask.getRecent().then(function(e){r.renderer.loading.message("Writing Releases to Database"),r.firestore.updateCollection(e,r._.user.username).then(function(e){r.renderer.loading.message("Wrote Releases to Database"),r._clearStore(),t()}).catch(n)}).catch(n)})}},{key:"setData",value:function(e){var t=this,n=e.user,r=e.collection,i=e.releases,a=e.spotify;this._={user:n,releases:i,spotify:a,collectionFolders:r.folders,collectionReleases:r.releases,missingReleaseIds:[]},Object.keys(this._.collectionReleases).forEach(function(e){t._.releases[e]||t._.missingReleaseIds.push(e)}),this._setStore({user:n,collection:r,releases:i,spotify:a})}},{key:"saveState",value:function(){var e=this._,t=e.user,n=e.collectionReleases,r=e.collectionFolders,i=e.releases,a=e.spotify,s={folders:r,releases:n};this._setStore({user:t,collection:s,releases:i,spotify:a})}},{key:"loadMissingReleases",value:function(){var o=this;return this.renderer.loading.enable(),this.renderer.loading.message("Loading "+this._.missingReleaseIds.length+" Releases from Discogs."),new Promise(function(e,t){for(var n=o._.missingReleaseIds,r=[],i=n.length<=30?30:10;0<n.length;)r.push(n.splice(0,i));var a=r.length,s=o._time(15*a);o.renderer.loading.message("This will take around "+s+" in "+a+" pass(es)."),o.loadReleases(r,a,0).then(function(){o.renderer.loading.message("Completed "+a+" pass(es)"),o._clearStore(),e()}).catch(t)})}},{key:"updateRelease",value:function(n){var r=this;return this.renderer.loading.enable(),new Promise(function(t,e){r.loadReleases([[n]],1,0).then(function(e){r._.releases[n]=e.data[n],r._.spotify[n]?(r.saveState(),r.renderer.loading.disable(),t()):r.searchSpotify(r._.releases[n]).then(function(e){r._.spotify[n]={id:e},r.saveState(),r.renderer.loading.disable(),t()})}).catch(e)})}},{key:"loadReleases",value:function(i,a,s){var o=this,c=i[s].length,e=i[s].join(",");return new Promise(function(n,r){o.webtask.getReleases(e).then(function(e){s++;var t=o._time(15*(a-s+1));o.renderer.loading.message("Got "+s+"/"+a+" batches of Releases from Discogs. ~"+t+" remaining."),s<a?(o.firestore.writeReleases(e).then(function(){o.renderer.loading.message("Wrote "+c+" Releases to Database.")}).catch(r),setTimeout(function(){n(o.loadReleases(i,a,s))},15e3)):o.firestore.writeReleases(e).then(function(){o.renderer.loading.message("Wrote "+c+" Releases to Database."),n(e)}).catch(r)}).catch(r)})}},{key:"process",value:function(){this.searchableReleases=Object.values(this._.collectionReleases).map(this._searchableRelease.bind(this)),this._categorizeReleases(this._.collectionReleases),this.searchableCompanies=Object.values(this.companies),this.fuseReleaseSearch=new Fuse(this.searchableReleases,{shouldSort:!0,includeMatches:!0,tokenize:!0,matchAllTokens:!0,findAllMatches:!0,threshold:.3,location:0,distance:100,maxPatternLength:32,minMatchCharLength:2,keys:["artistTitle"]}),this.fuseCompanySearch=new Fuse(this.searchableCompanies,{shouldSort:!0,includeMatches:!0,tokenize:!0,matchAllTokens:!0,findAllMatches:!0,threshold:.3,location:0,distance:100,maxPatternLength:32,minMatchCharLength:2,keys:["name"]}),this.randomRelease(),this.detectMissingSpotify()}},{key:"detectMissingSpotify",value:function(){var n=this,t=Object.keys(this._.spotify),e=Object.values(this._.collectionReleases).filter(function(e){return!t.includes(e.id)});0<e.length&&(console.info("Missing Spotify Data"),console.info(e.map(function(e){var t=n._.releases[e.id];return{title:t.title,id:t.id}})))}},{key:"randomRelease",value:function(){var e=Object.keys(this._.releases),t=e[Math.floor(Math.random()*e.length)];this.renderer.results.itemType="release",this.renderer.currResultId=t,this.renderer.release.render(t)}},{key:"search",value:function(e,t){if(!this.fuseReleaseSearch)return null;if(!e)return null;var n="release"===t?this.fuseReleaseSearch:this.fuseCompanySearch;return n.search(e)}},{key:"_time",value:function(e){var t=Math.floor(e/30);return e-=30*t,(t=t<10?"0"+t:t)+":"+(e=e<10?"0"+e:e)}},{key:"_getStore",value:function(){return localStorage.getItem(c)}},{key:"_setStore",value:function(e){localStorage.setItem(c,JSON.stringify(e))}},{key:"_clearStore",value:function(){localStorage.removeItem(c)}},{key:"_searchableRelease",value:function(e){var t=this._.releases[e.id],n={};n.id=t.id,n.title=t.title,n.year=t.year,n.artist=Object.values(t.artists).map(function(e){return e.name}).join(", "),n.artistTitle=n.artist+": "+n.title,n.folder=this._.collectionFolders[e.folderId].name,n.companies=Object.values(t.labels).concat(Object.values(t.companies)).map(function(e){return e.name}).join(", ");var r={};return t.formats.forEach(function(e){return r[e.name]=1}),n.format=Object.keys(r).join(", "),n}},{key:"_categorizeReleases",value:function(e){var i=this;this.categorized={artist:{},label:{},companies:{}},this.companies={},Object.values(e).forEach(function(e){var r=i._.releases[e.id];Object.values(r.artists).forEach(function(e){var t=e.name;"Various"!==t&&(i.categorized.artist[t]=i.categorized.artist[t]||[],i.categorized.artist[t].push(r.id))}),Object.values(r.labels).concat(Object.values(r.companies)).forEach(function(e){var t=e.type+"-"+e.id,n=i.companies[e.id];n?n.types.includes(e.type)||n.types.push(e.type):i.companies[e.id]={id:e.id,name:e.name,types:[e.type]},i.categorized.companies[t]=i.categorized.companies[t]||[],i.categorized.companies[t].push(r.id)})})}}]),n}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=n(9),o=(r=a)&&r.__esModule?r:{default:r};var s="jakealbaugh",c=function(){function n(e){for(var t in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),o.default)o.default[t].initialize(e)}return i(n,[{key:"getAllData",value:function(){return new Promise(function(t,n){var r={collection:{}};o.default.Spotify.get().then(function(e){r.spotify=e,o.default.Users.get(s).then(function(e){e.exists?(r.user=e.data(),o.default.Folders.getCollectionFolders(s).then(function(e){r.collection.folders=e,o.default.Releases.getCollectionReleases(s).then(function(e){r.collection.releases=e,o.default.Releases.getReleases().then(function(e){r.releases=e,t(r)}).catch(n)}).catch(n)}).catch(n)):(r.user={},r.spotify={},r.collection={folders:{},releases:{}},r.releases={},t(r))}).catch(n)}).catch(n)})}},{key:"writeCollection",value:function(s){return new Promise(function(e,t){200!==s.status&&t(s);s.status;var n=s.data,r=n.user,i=n.releases,a=n.folders;o.default.Users.create(r).then(function(){o.default.Folders.batchCreateCollectionFolders(r,a).then(function(){o.default.Releases.batchCreateCollectionReleases(r,i).then(e).catch(t)}).catch(t)}).catch(t)})}},{key:"updateCollection",value:function(r,i){return new Promise(function(e,t){200!==r.status&&t(r);r.status;var n=r.data.releases;o.default.Releases.batchUpdateCollectionReleases(n,i).then(e).catch(t)})}},{key:"writeReleases",value:function(r){return new Promise(function(e,t){200!==r.status&&t(r);r.status;var n=r.data;o.default.Releases.batchCreateReleases(n).then(e).catch(t)})}},{key:"writeSpotify",value:function(n){return new Promise(function(e,t){o.default.Spotify.batchUpdateSpotify(n).then(e).catch(t)})}},{key:"updateSpotifyId",value:function(n,r){return new Promise(function(e,t){o.default.Spotify.updateSpotifyId(n,r).then(e).catch(t)})}}]),n}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(10)),i=o(n(11)),a=o(n(13)),s=o(n(14));function o(e){return e&&e.__esModule?e:{default:e}}var c={Folders:new r.default,Releases:new i.default,Spotify:new a.default,Users:new s.default};t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=n(0),s=(r=a)&&r.__esModule?r:{default:r};var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"batchCreateCollectionFolders",value:function(a,s){var o=this;return new Promise(function(e,t){var n=o.database.batch();for(var r in s){var i=o.database.collection("collections").doc(a.username).collection("folders").doc(r);n.set(i,s[r])}n.commit().then(e).catch(t)})}},{key:"getCollectionFolders",value:function(n){var r=this;return new Promise(function(t,e){r.database.collection("collections").doc(n).collection("folders").get().then(function(e){return t(r.documents(e))}).catch(e)})}}]),t}();t.default=o},function(e,a,o){"use strict";(function(s){Object.defineProperty(a,"__esModule",{value:!0});var e,n=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),t=o(0),r=(e=t)&&e.__esModule?e:{default:e};var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),n(t,[{key:"batchCreateCollectionReleases",value:function(a,s){var o=this;return new Promise(function(r,i){o.batchDelete(a).then(function(){var e=o.database.batch();for(var t in s){var n=o.database.collection("collections").doc(a.username).collection("releases").doc(t);e.set(n,s[t])}e.commit().then(r).catch(i)})})}},{key:"batchUpdateCollectionReleases",value:function(a,s){var o=this;return new Promise(function(e,t){var n=o.database.batch();for(var r in a){var i=o.database.collection("collections").doc(s).collection("releases").doc(r);n.set(i,a[r])}n.commit().then(e).catch(t)})}},{key:"batchDelete",value:function(e){var n=this,r=this.database.collection("collections").doc(e.username).collection("releases").orderBy("__name__").limit(20);return new Promise(function(e,t){n._deleteQueryBatch(r,20,e,t)})}},{key:"batchCreateReleases",value:function(a){var s=this;return new Promise(function(e,t){var n=s.database.batch();for(var r in a){var i=s.database.collection("releases").doc(r);n.set(i,a[r])}n.commit().then(e).catch(t)})}},{key:"getCollectionReleases",value:function(n){var r=this;return new Promise(function(t,e){r.database.collection("collections").doc(n).collection("releases").get().then(function(e){return t(r.documents(e))}).catch(e)})}},{key:"getReleases",value:function(){var n=this;return new Promise(function(t,e){n.database.collection("releases").get().then(function(e){return t(n.documents(e))}).catch(e)})}},{key:"_deleteQueryBatch",value:function(t,n,r,i){var a=this;t.get().then(function(e){if(0==e.size)return 0;var t=a.database.batch();return e.docs.forEach(function(e){t.delete(e.ref)}),t.commit().then(function(){return e.size})}).then(function(e){e<n?r():s.nextTick(function(){a._deleteQueryBatch(t,n,r,i)})}).catch(i)}}]),t}();a.default=i}).call(a,o(12))},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(t){if(n===setTimeout)return setTimeout(t,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,l=[],u=!1,f=-1;function h(){u&&c&&(u=!1,c.length?l=c.concat(l):f=-1,l.length&&d())}function d(){if(!u){var e=o(h);u=!0;for(var t=l.length;t;){for(c=l,l=[];++f<t;)c&&c[f].run();f=-1,t=l.length}c=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||u||o(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=n(0),s=(r=a)&&r.__esModule?r:{default:r};var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"updateSpotifyId",value:function(n,r){var i=this;return new Promise(function(e,t){i.database.collection("spotify").doc(n).set({id:r}).then(e).catch(t)})}},{key:"batchUpdateSpotify",value:function(e){var t=this.database.batch();for(var n in e){var r=this.database.collection("spotify").doc(n);t.set(r,e[n].id)}t.commit().then(resolve).catch(reject)}},{key:"get",value:function(){var n=this;return new Promise(function(t,e){n.database.collection("spotify").get().then(function(e){return t(n.documents(e))}).catch(e)})}}]),t}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=n(0),s=(r=a)&&r.__esModule?r:{default:r};var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"create",value:function(n){var r=this;return new Promise(function(e,t){r.database.collection("users").doc(n.username).set(n).then(e).catch(t)})}},{key:"get",value:function(n){var r=this;return new Promise(function(e,t){r.database.collection("users").doc(n).get().then(e).catch(t)})}}]),t}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=l(n(16)),a=l(n(17)),s=l(n(18)),o=l(n(19)),c=l(n(20));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function n(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.store=e,this.view=new c.default(this),this.company=new i.default(this),this.loading=new a.default(this),this.results=new o.default(this),this.release=new s.default(this),this.resultIds=[],this.currResultIdx=-1,this.setSearch(),this.$downloadStore=document.querySelector("#download-store"),this.$downloadStoreClick=document.querySelector("#download-store-click"),this.$downloadStoreClick.setAttribute("download",this.store.localKey+".json"),this.$updateCollection=document.querySelector("#update-collection"),this.$clearLocal=document.querySelector("#clear-local"),this.$updateRecent=document.querySelector("#update-recent"),this.$updateRelease=document.querySelector("#update-release"),this.$randomRelease=document.querySelector("#random-release"),this.$randomRelease.addEventListener("click",function(){t.store.randomRelease()}),this.store.app.masterUser?(this.$updateCollection.addEventListener("click",function(){window.confirm("This might take a bit, are you sure?")&&t.store.writeCollection().then(function(){window.location.reload()})}),this.$updateRecent.addEventListener("click",function(){t.store.updateCollection().then(function(){window.location.reload()})}),this.$clearLocal.addEventListener("click",function(){t.store._clearStore(),window.location.reload()}),this.$updateRelease.addEventListener("click",function(){var e=t.currResultId;e?t.store.updateRelease(e).then(function(){t.release.render(e)}):alert("No Release to Update.")}),this.$downloadStore.addEventListener("click",function(){t.downloadStoreAsJSON()})):(this.$clearLocal.remove(),this.$downloadStore.remove(),this.$downloadStoreClick.remove(),this.$updateRecent.remove(),this.$updateCollection.remove(),this.$updateRelease.remove()),document.body.addEventListener("keydown",function(e){[40,38,27,13].includes(e.keyCode)&&!t.viewOpen&&e.preventDefault(),40===e.keyCode?t.handleArrowDown():38===e.keyCode?t.handleArrowUp():27===e.keyCode?t.handleEscape():13===e.keyCode&&t.handleReturn()})}return r(n,[{key:"downloadStoreAsJSON",value:function(){var e=encodeURIComponent(this.store._getStore());this.$downloadStoreClick.setAttribute("href","data:text/json;charset=utf-8,"+e),this.$downloadStoreClick.click()}},{key:"setSearch",value:function(){this.$searchType=document.querySelector("#search-type"),this.$search=document.querySelector("#search"),this.$search.focus(),this.$searchType.addEventListener("change",this.handleSearch.bind(this)),this.$search.addEventListener("input",this.handleSearch.bind(this))}},{key:"handleSearch",value:function(){var e=this.$searchType.checked?"company":"release",t=this.store.search(this.$search.value.replace(/ +$/,""),e);this.resultIds=[],this.currResultIdx=-1,this.results.render(t,e),this.handleArrowDown()}},{key:"handleArrowDown",value:function(){!this.viewOpen&&this.currResultIdx<this.resultIds.length-1&&this.handleCurrentItem(1)}},{key:"handleArrowUp",value:function(){!this.viewOpen&&0<this.currResultIdx&&this.handleCurrentItem(-1)}},{key:"handleReturn",value:function(){if("release"===this.results.itemType){var e=this.currResultId;e&&(this.viewOpen=!this.viewOpen,this.viewOpen?(this.view.render(this.store._.releases[e]),this.view.show()):this.view.hide())}}},{key:"handleEscape",value:function(){this.viewOpen&&this.view.hide(),this.viewOpen=!1}},{key:"handleItemClick",value:function(e){this.currResultIdx=e,this.handleCurrentItem(0)}},{key:"handleCurrentItem",value:function(e){var t=null;0<this.resultIds.length&&(this.currResultIdx+=e,t=this.resultIds[this.currResultIdx],this.currResultId=t,"release"===this.results.itemType?this.release.render(t):"company"===this.results.itemType&&this.company.render(t)),this.results.setCurrent(t)}}]),n}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=n(1),s=(r=a)&&r.__esModule?r:{default:r};var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"render",value:function(e){this.renderer.currResultId=e,this.renderer.$search.focus(),this.renderer.$updateRelease.setAttribute("disabled",!0),this.company=this.store.companies[e],this.$image.classList.add("hide"),this.$artist.classList.add("hide"),this.$meta.classList.add("hide"),this.$view.classList.add("hide"),this.$artistList.classList.add("hide"),this.$labelList.classList.add("hide"),this.renderMain(),this.renderLists()}},{key:"renderLists",value:function(){var r=this;this.$companyList.innerHTML="",this.company.types.forEach(function(e){var t=e+"-"+r.company.id,n=r.store.categorized.companies[t];n&&r.renderList(r.$companyList,r.company.name,n,!0,[],e)})}},{key:"renderMain",value:function(){this.$title.innerHTML='<a href="https://www.discogs.com/label/'+this.company.id+'" target="blank">\n      '+this.company.name.replace(/ ([^ ]+)$/,"&nbsp;$1")+"\n    </a>"}}]),t}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderer=e,this.$container=document.querySelector("#loading"),this.$container.classList.add("hide"),this.$ul=this.$container.querySelector("ul")}return r(t,[{key:"enable",value:function(){this.$container.classList.remove("hide")}},{key:"disable",value:function(){this.$container.classList.add("hide"),this.$ul.innerHTML=""}},{key:"message",value:function(e){var t=document.createElement("li"),n=this.$ul.querySelector("li:first-child");t.innerHTML=e,n?this.$ul.insertBefore(t,n):this.$ul.appendChild(t)}}]),t}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=n(1),s=(r=a)&&r.__esModule?r:{default:r};var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"render",value:function(e){this.renderer.currResultId=e,this.renderer.$search.focus(),this.renderer.$updateRelease.removeAttribute("disabled"),this.release=this.store._.releases[e],this.$image.classList.remove("hide"),this.$artist.classList.remove("hide"),this.$meta.classList.remove("hide"),this.$view.classList.remove("hide"),this.$artistList.classList.remove("hide"),this.$labelList.classList.remove("hide"),this.renderMain(),this.renderMeta(),this.renderButton(),this.renderLists()}},{key:"renderLists",value:function(){var r=this,i=[this.release.id];this.$artistList.innerHTML="",Object.values(this.release.artists).forEach(function(e){var t=r.store.categorized.artist[e.name];t&&r.renderList(r.$artistList,e.name,t,!1,i)}),this.$labelList.innerHTML="",Object.values(this.release.labels).forEach(function(e){var t=r.store.categorized.companies["Label-"+e.id];t&&r.renderList(r.$labelList,e.name,t,!0,i,"Label")}),this.$companyList.innerHTML="",Object.values(this.release.companies).forEach(function(e){var t=e.type+"-"+e.id,n=r.store.categorized.companies[t];n&&r.renderList(r.$companyList,e.name,n,!0,i,e.type)})}},{key:"renderMain",value:function(){var e=this.release.images?this.release.images[0]:null;this.$image.style.backgroundImage=e?"url('"+e.uri+"')":"none",this.$title.innerHTML='<a href="https://www.discogs.com/release/'+this.release.id+'" target="blank">\n      '+this.release.title.replace(/ ([^ ]+)$/,"&nbsp;$1")+"\n    </a>";var t=1900<this.release.year?",&nbsp;"+this.release.year:"";this.$artist.innerHTML=Object.values(this.release.artists).map(function(e){return'<span><a href="https://www.discogs.com/artist/'+e.id+'" target="blank">'+e.name+"</a></span>"}).join(", ")+t}},{key:"renderMeta",value:function(){this.$meta.innerHTML="";var e=Object.values(this.release.labels).map(function(e){return'<span>\n            <a href="https://www.discogs.com/label/'+e.id+'" target="blank">\n            '+e.name.split(" ").join("&nbsp;")+"</a>&nbsp;"+e.catno.split(" ").join("&nbsp;")+"</span>"}).join(", ");this.$meta.innerHTML+='<p class="label">'+e+"</p>"}},{key:"renderButton",value:function(){var e=this;this.$view.innerHTML="";var t=document.createElement("button");t.setAttribute("type","button"),t.setAttribute("title","shortcut: return"),t.classList.add("is-small"),t.innerHTML="View",t.addEventListener("click",function(){e.renderer.handleReturn()}),this.$view.appendChild(t)}}]),t}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderer=e,this.store=e.store,this.$container=document.querySelector("#results")}return r(t,[{key:"setCurrent",value:function(e,t){var n=this.$container.querySelector("li.selected");if(n&&n.classList.remove("selected"),e){var r=this.$container.querySelector("li.release-"+e);r.classList.add("selected"),r.scrollIntoView()}}},{key:"render",value:function(i,a){var s=this;if(this.itemType=a,this.currResultIdx=-1,this.$container.innerHTML="",i)for(var e=Math.min(30,i.length),t=function(t){var e=i[t],n=document.createElement("li"),r=document.createElement("a");s.renderer.resultIds.push(e.item.id),n.classList.add("release-"+e.item.id),r.innerHTML="release"===s.itemType?s.renderRelease(e):s.renderCompany(e),r.setAttribute("href","#"),r.setAttribute("tabindex","-1"),r.addEventListener("click",function(e){s.renderer.results.itemType=a,e.preventDefault(),r.blur(),s.renderer.$search.focus(),s.renderer.handleItemClick(t)}),n.appendChild(r),s.$container.appendChild(n)},n=0;n<e;n++)t(n)}},{key:"renderRelease",value:function(e){var t=this,n={};e.matches.forEach(function(e){n[e.key]=t.renderMatch(e)});var r=this.store._.releases[e.item.id],i=r.images?r.images[0]:null,a=void 0;return a=i?'<div class="image" style="background-image: url(\''+i.uri+"')\"></div>":'<div class="image"></div>',a+='\n      <div class="title">',n.artistTitle?a+=n.artistTitle:a+=e.item.artist+": "+e.item.title,a+="\n        "+(1900<e.item.year?"("+e.item.year+")":"")+'\n      </div>\n      <div class="format">\n        '+e.item.format+"\n      </div>"}},{key:"renderCompany",value:function(e){var t=this,n={};e.matches.forEach(function(e){n[e.key]=t.renderMatch(e)});this.store.companies[e.item.id];var r='\n      <div class="title">';return n.name?r+=n.name:r+=e.item.name,r+='\n      </div>\n      <div class="format">\n        '+e.item.types.join(", ")+"\n      </div>"}},{key:"renderMatch",value:function(e){var t=e.value,n=e.indices.map(function(e){return e[0]}),r=e.indices.map(function(e){return e[1]}),i=!0,a="";return t.split("").forEach(function(e,t){i?void 0!==n[0]&&n[0]===t?(n[0]===r[0]?(a+="<span>"+e+"</span>",r.shift()):(a+="<span>"+e,i=!1),n.shift()):a+=e:void 0!==r[0]&&r[0]===t?(a+=e+"</span>",r.shift(),i=!0):a+=e}),a}}]),t}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var i=function(){function n(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.renderer=e,this.store=e.store,this.$container=document.querySelector("#overlay"),this.$h1=this.$container.querySelector("h1"),this.$image=this.$container.querySelector(".image"),this.$title=this.$container.querySelector(".title"),this.$artist=this.$container.querySelector(".artist"),this.$meta=this.$container.querySelector(".meta"),this.$close=this.$container.querySelector("#close"),this.$updateSpotify=this.$container.querySelector(".update-spotify"),this.$close.addEventListener("click",function(){t.renderer.handleEscape()}),this.$companies=this.$container.querySelector(".companies"),this.$tracklist=this.$container.querySelector(".tracklist ul"),this.$spotify=this.$container.querySelector(".tracklist .spotify-frame"),this.store.app.masterUser&&this.initializeSpotifyForm()}return r(n,[{key:"hide",value:function(){this.$container.classList.add("hide"),this.renderer.$search.focus()}},{key:"show",value:function(){this.$container.classList.remove("hide"),this.$tracklist.focus()}},{key:"render",value:function(e){this.releaseId=e.id,this.release=e,this.collectionRelease=this.store._.collectionReleases[e.id],this.renderImage(),this.renderTitle(),this.renderArtist(),this.renderMeta(),this.renderCompanies(),this.renderTracklist(),this.store.app.masterUser&&this.renderSpotifyForm()}},{key:"renderImage",value:function(){var e=this.release.images[0];this.$image.style.backgroundImage=e?"url('"+e.uri+"')":"none"}},{key:"renderTitle",value:function(){var e=this.release,t=e.title,n=e.id;this.$title.innerHTML='<a href="https://www.discogs.com/release/'+n+'" target="blank">\n      '+t.replace(/ ([^ ]+)$/,"&nbsp;$1")+"\n    </a>",this.$h1.innerHTML=t}},{key:"renderArtist",value:function(){var e=this.release,t=e.artists,n=e.year;n=1900<n?",&nbsp;"+n:"",this.$artist.innerHTML=Object.values(t).map(function(e){return'<span><a href="https://www.discogs.com/artist/'+e.id+'" target="blank">'+e.name+"</a></span>"}).join(", ")+n}},{key:"renderMeta",value:function(){var e=this.release,t=e.formats,n=e.labels,r=this.collectionRelease,i=r.added,a=r.folderId;this.$meta.innerHTML="",n=Object.values(n).map(function(e){return'<span>\n            <a href="https://www.discogs.com/label/'+e.id+'" target="blank">\n            '+e.name.split(" ").join("&nbsp;")+"</a>&nbsp;"+e.catno+"</span>"}).join(", "),this.$meta.innerHTML+='<p class="label">'+n+"</p>";var s={};this.$meta.innerHTML+='<p class="format">'+t.map(function(e){return s[e.name]?"":(s[e.name]=1,"<span>"+e.name+" ("+e.quantity+")</span>")}).join("")+"</p>";var o=this.store._.collectionFolders[a].name,c=this.renderDateFromEpoch(i);this.$meta.innerHTML+='<p class="folder"><strong>'+o+"</strong> "+c+"</p>"}},{key:"renderCompanies",value:function(){var e=this.release.companies;this.$companies.innerHTML="",e=Object.values(e).map(function(e){var t=e.name,n=e.id;return"<span>\n            "+e.type+':\n            <a href="https://www.discogs.com/label/'+n+'" target="blank">\n            '+t.split(" ").join("&nbsp;")+"</a></span>"}).join("<br>"),this.$companies.innerHTML+='<p class="label">'+e+"</p>"}},{key:"initializeSpotifyForm",value:function(){var e=this;this.$updateSpotify.classList.remove("hide"),this.$spotifyId=this.$updateSpotify.querySelector("input"),this.$spotifySubmit=this.$updateSpotify.querySelector("button"),this.$spotifySubmit.addEventListener("click",function(){e.renderer.loading.enable(),e.renderer.loading.message("Updating Spotify Id"),e.store.updateSpotifyId(e.releaseId,e.$spotifyId.value).then(function(){e.renderer.loading.disable(),e.renderTracklist()})})}},{key:"renderSpotifyForm",value:function(){var e=this.store._.spotify[this.releaseId];this.$spotifyId.value=void 0!==e?e.id:""}},{key:"renderTracklist",value:function(){var r=this,e=this.store._.releases[this.releaseId],t=e.tracklist;e.artists,e.title,e.id;this.$tracklist.innerHTML="",this.$spotify.innerHTML="";var n=this.store._.spotify&&this.store._.spotify[e.id];n&&""!==n.id&&(this.$spotify.innerHTML='<iframe src="https://open.spotify.com/embed/album/'+n.id+'"\n          width="300" height="380" frameborder="0" allowtransparency="true"></iframe>',this.$spotify.classList.remove("hide")),t.forEach(function(e){var t=document.createElement("li"),n=e.title.replace(/ ([^ ]+)$/,"&nbsp;$1");t.classList.add(e.type),t.innerHTML="<span>"+e.position+"</span><span>"+n+"</span>",r.$tracklist.appendChild(t)})}},{key:"truncatedString",value:function(e){return e.length<=75?e:e.substring(0,75).replace(/ +$/,"")+"…"}},{key:"renderDateFromEpoch",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=new Date(e),r=n.getFullYear(),i=["January","February","March","April","May","June","July","August","September","October","November","December"][n.getMonth()],a=n.getDate();return t?i+" "+a+", "+r:i+" "+r}}]),n}();t.default=i}]);